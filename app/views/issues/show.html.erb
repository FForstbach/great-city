
<div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-offset-4 col-sm-4">
      <p id="notice"><%= notice %></p>
      <%= link_to '< Go back to overview', issues_path %>
      <div id="project_detail">
        <div>
          <h1><%= @issue.title.upcase %></h1>
        </div>
        <div>
          <%= image_tag @issue.photo.url(:medium) %>
        </div>
        <div>
          <h4>Description</h4>
          <p><%= @issue.description %></p>
          <h4>Address</h4>
          <p><%= @issue.address %></p>
          <h4>Votes</h4>
          <p id='vote-count'><%= !@issue.votes.nil? ? @issue.votes : "0" %> votes so far</p>
        </div>
        <div>
          <p class="button vote" id="issue-<%= @issue.id %>">Vote for this project</p>
          <a href='', id='share-link'>
          Click to copy link
          </a>
        </div>
      </div>
      <div id="map" style="width: 100%; height: 230px;"></div>
      <%= link_to 'Edit', edit_issue_path(@issue) %> |
      <%= link_to 'Back', issues_path %>
      <td><%= link_to 'Destroy', issue_path, method: :delete, data: { confirm: 'Are you sure?' } %></td>
    </div>
  </div>
</div>

<script>
var link = document.getElementById('share-link');
link.addEventListener("click", function(event){
    event.preventDefault();
});

new Clipboard('#share-link', {
    text: function(trigger) {
        alert('Link copied to clipboard!')
        return window.location.href;
    }
});

$( document ).ready(function() {
  $("p[id*='issue-']").one( "click", function(elem) {
    var id = elem.target.id.replace('issue-','')
    var votes = parseInt($('#vote-count').text()) + 1
    $('#vote-count').text(votes + ' votes so far')
    $.ajax({
      url: '/issues/' + id + '/vote',
      method: 'POST'
    })

  });
});

</script>

    <!-- Include Google Maps JS library. You should use your *own* key -->
    <script src="https://maps.google.com/maps/api/js?key="<%= ENV[GOOGLE_API_BROWSER_KEY] %>"></script>

    <!-- Include Dependencies of GMaps for Rails gem -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-marker-clusterer/1.0.0/markerclusterer_compiled.js"></script>
    <script src="https://cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js"></script>
    <script src="https://cdn.rawgit.com/apneadiving/Google-Maps-for-Rails/master/js_compilation/gmaps_google.js"></script>

    <script type="text/javascript">
      $(document).on('ready', function() {
        var handler = Gmaps.build('Google', { markers: { clusterer: undefined }});
        handler.buildMap({ internal: { id: 'map' } }, function(){
          markers = handler.addMarkers([
            {
              "lat": <%=  @issue.latitude %>,
              "lng": <%= @issue.longitude %>,
              "infowindow": "<h1><%= @issue.title %></h1><p><img src='https://d1gofzrmx0fcbg.cloudfront.net/production/cities/city_pictures/000/000/008/thumbnail/marseille.jpg?1445520529' height='200'></p>"
            }
          ]);
          handler.bounds.extendWith(markers);
          handler.fitMapToBounds();
        });
      })
    </script>
  </body>
</html>


<!--
Ruby script which generated the markers from lewagon/alumni repo:
require "json"
markers = []
City.order(:name).each do |city|
  if city.latitude && city.longitude
    markers << {
      lat: city.latitude,
      lng: city.longitude,
      infowindow: "<h1>#{city.name}</h1><p><img src='#{city.city_picture.url(:thumbnail)}' height='200'></p>"
    }
  end
end
puts JSON.pretty_generate(markers)
-->
