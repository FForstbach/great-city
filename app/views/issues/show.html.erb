
<div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-offset-4 col-sm-4">
      <p id="notice"><%= notice %></p>
      <%= link_to '< Go back to overview', issues_path %>
      <div id="project_detail">
        <h1><%= @issue.title.upcase %></h1>
        <h4><%= @issue.description %></h4>
        <%= image_tag @issue.photo.url(:medium) %>
        <div class="card link">
          <h3 id="issue-<%= @issue.id %>">Vote for this project</h3>
          <i class="fa fa-star-o" aria-hidden="true"></i>
          <p id='vote-count'><%= !@issue.votes.nil? ? @issue.votes : "0" %> votes so far</p>
        </div>
        <a href='', id='share-link'>Click to copy link</a>
      </div>

      <div id="map" style="width: 100%; height: 600px;"></div>

      <%= link_to 'Edit', edit_issue_path(@issue) %> |
      <%= link_to 'Back', issues_path %>
      <td><%= link_to 'Destroy', issue_path, method: :delete, data: { confirm: 'Are you sure?' } %></td>
    </div>
  </div>
</div>

<script>
var link = document.getElementById('share-link');
link.addEventListener("click", function(event){
    event.preventDefault();
});

new Clipboard('#share-link', {
    text: function(trigger) {
        alert('Link copied to clipboard!')
        return window.location.href;
    }
});

$( document ).ready(function() {
  $("h3[id*='issue-']").one( "click", function(elem) {
    var id = elem.target.id.replace('issue-','')
    var votes = parseInt($('#vote-count').text()) + 1
    $('#vote-count').text(votes + ' votes so far')
    $.ajax({
      url: '/issues/' + id + '/vote',
      method: 'POST'
    })

  });
});

</script>
